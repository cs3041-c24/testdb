<!DOCTYPE html>

<html>
<head>
    <link rel="stylesheet" type="text/css" href="https://x3dom.org/release/x3dom.css" media="screen and (orientation:portrait)"/>
    <script src="https://d3js.org/d3.v7.min.js" />
    <script src="https://x3dom.org/release/x3dom-full.js" />
    <script src="https://cdn.jsdelivr.net/npm/d3-x3d@2.1.5/dist/d3-x3d.min.js" />
    <meta name="viewport" content="width=device-width, user-scalable=no"/>
    <title> COLOR ASSN </title>
</head>

<body>
    <!-- HTML5 article tag for content -->
    <div id="content">
   
    <header>COLOR ASSOCIATION TEST - RESULTS</header>

   <h1>Color Association Test - Results</h1>
    </div>

    <div id="chartholder" />

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
        // Documentation: https://firebase.google.com/docs/web/setup#available-libraries
      
        // Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyD9iR4okBA8TRKZZtOGd_F57CF54kQpExQ",
          authDomain: "colorassn.firebaseapp.com",
          databaseURL: "https://colorassn-default-rtdb.firebaseio.com/",
          projectId: "colorassn",
          storageBucket: "colorassn.appspot.com",
          messagingSenderId: "820973011771",
          appId: "1:820973011771:web:80d213bbd5a510cc2d2d1e"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // Initialize Realtime Database and get a reference to the service
        const database = getDatabase(app);
        
        // NONE OF THIS CODE IS MINE. THIS IS JUST A TEST.
        function loadChart(data) {
            // Select chartholder
            var chartHolder = d3.select("#chartholder");

            // Declare the chart component
            var myChart = d3.x3d.chart.particlePlot()
            .mappings({ x: "ridge", y: "nub", z: "crack", size: "density", color: "weight" })
            .colors(d3.schemeRdYlGn[8]);

            // Generate chart
            chartHolder.datum(data).call(myChart);
        }

        // Generate Chart fro Pollen CSV Data
        // Source: http://metagrid2.sv.vt.edu/~npolys/InfoVis2019/pollen.csv
        d3.csv("./pollen.csv")
            .then((data) => {
            var points = data.map((d) => {
                return {
                key: 'Point' + d.OBSERVATION_NUMBER,
                values: [
                    { key: "weight", value: +d.WEIGHT },
                    { key: "density", value: +d.DENSITY },
                    { key: "ridge", value: +d.RIDGE },
                    { key: "nub", value: +d.NUB },
                    { key: "crack", value: +d.CRACK },
                ]
                };
            });

            var pollenData = {
                key: 'Pollen',
                values: points
            };

            loadChart(pollenData);
            })
            .finally(() => {
            x3dom.reload();
            });
    </script>
</body>
</html>